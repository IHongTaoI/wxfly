webpackJsonp([10],{"99Dp":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("HzJ8"),s=n.n(a),i=n("lC5x"),r=n.n(i),c=n("J0Oq"),o=n.n(c),l={data:function(){return{content:"",imgs:"",showAdd:!0,isloading:!1,cachefiles:[],cacheImgs:[],wordLimit:200,stepCount:0}},watch:{content:function(t,e){this.wordCount||(this.content=e)}},computed:{wordCount:function(){var t=this.content.length,e=this.wordLimit-t;return e>=0?e:0}},methods:{submit:function(){var t=this;return o()(r.a.mark(function e(){var n,a;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n="",a=void 0,!t.isloading){e.next=3;break}return e.abrupt("return");case 3:if(t.isloading=!0,0!==t.stepCount||!t.cachefiles.length){e.next=13;break}return e.next=7,t.uploadImg();case 7:if(n=e.sent){e.next=12;break}return t.isloading=!1,t.$toast.fail("图片上传失败"),e.abrupt("return");case 12:n=n.d.urls.join(",");case 13:if(t.stepCount=1,1!==t.stepCount){e.next=18;break}return e.next=17,t.$apihelper.sendShare({content:t.content,imgs:n,tip:"&*asd1@213SAf",isShowAdd:t.showAdd?"1":"0",lng:t.$store.state.user.lng+"",lat:t.$store.state.user.lat+""});case 17:a=e.sent;case 18:if(a){e.next=22;break}return t.isloading=!1,t.$toast.fail("发布失败"),e.abrupt("return");case 22:t.stepCount=-1,t.$router.replace({path:"/home"});case 24:case"end":return e.stop()}},e,t)}))()},uploadImg:function(){var t=this;return o()(r.a.mark(function e(){var n,a,i,c,o,l,u;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=new FormData,a=!0,i=!1,c=void 0,e.prev=4,o=s()(t.cachefiles);!(a=(l=o.next()).done);a=!0)u=l.value,n.append("imgs",u);e.next=12;break;case 8:e.prev=8,e.t0=e.catch(4),i=!0,c=e.t0;case 12:e.prev=12,e.prev=13,!a&&o.return&&o.return();case 15:if(e.prev=15,!i){e.next=18;break}throw c;case 18:return e.finish(15);case 19:return e.finish(12);case 20:return e.next=22,t.$apihelper.uploadImg(n);case 22:return e.abrupt("return",e.sent);case 23:case"end":return e.stop()}},e,t,[[4,8,12,20],[13,,15,19]])}))()},readcheck:function(){this.$toast("敬请期待!!")},getLocation:function(){this.$toast("敬请期待!!")},imagePreview:function(t){this.$utils.imagePreview(this.cacheImgs,t)},inputImgChange:function(t){var e=this;return o()(r.a.mark(function t(){var n;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=new FileReader,e.cachefiles.push(e.$refs.file.files[0]),n.readAsDataURL(e.$refs.file.files[0]),n.onload=function(){e.cacheImgs.push(n.result)};case 4:case"end":return t.stop()}},t,e)}))()}}},u={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"paddingTopNav",attrs:{id:"publish"}},[n("van-nav-bar",{staticClass:"topNavBar",attrs:{title:"","left-arrow":""},on:{"click-left":function(e){return t.$router.go(-1)}}},[n("van-button",{staticClass:"HBtn",attrs:{slot:"right",type:"primary",loading:t.isloading},nativeOn:{click:function(e){return t.submit(e)}},slot:"right"},[t._v("发表")])],1),t._v(" "),n("div",{staticClass:"line"}),t._v(" "),n("div",{staticClass:"textare"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],staticClass:"textCont",attrs:{cols:"30",rows:"10",placeholder:"这一刻的想法..."},domProps:{value:t.content},on:{input:function(e){e.target.composing||(t.content=e.target.value)}}}),t._v(" "),n("span",{staticClass:"wc"},[t._v(t._s(t.wordCount))])]),t._v(" "),n("div",{staticClass:"imgs"},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.cacheImgs.length<6,expression:"cacheImgs.length < 6"}],staticClass:"jia item"},[n("div",{staticClass:"box"},[n("span",{staticClass:"iconfont icon-jia"}),t._v(" "),n("input",{ref:"file",staticClass:"file",attrs:{type:"file",multiple:""},on:{change:function(e){return t.inputImgChange()}}})])]),t._v(" "),t._l(t.cacheImgs,function(e,a){return n("div",{key:a,staticClass:"item"},[n("div",{staticClass:"box"},[n("img",{staticClass:"img",attrs:{src:e},on:{click:function(e){return t.imagePreview(a)}}})])])})],2),t._v(" "),n("van-cell-group",[n("van-cell",{attrs:{title:"所在位置","is-link":""},nativeOn:{click:function(e){return t.getLocation(e)}}},[n("span",{staticClass:"iconfont icon-weizhi",attrs:{slot:"icon"},slot:"icon"})]),t._v(" "),n("van-cell",{attrs:{title:"谁可以看","is-link":"",value:"公开"},nativeOn:{click:function(e){return t.readcheck(e)}}},[n("span",{staticClass:"iconfont icon-yonghuicon",attrs:{slot:"icon"},slot:"icon"})]),t._v(" "),n("van-switch-cell",{attrs:{title:"显示地址"},model:{value:t.showAdd,callback:function(e){t.showAdd=e},expression:"showAdd"}})],1)],1)},staticRenderFns:[]};var d=n("C7Lr")(l,u,!1,function(t){n("rZUz")},"data-v-ecdc4ae0",null);e.default=d.exports},rZUz:function(t,e){}});
//# sourceMappingURL=10.b2c1c0aeafe9b4021046.js.map