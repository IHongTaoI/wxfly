webpackJsonp([14],{ANHP:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("aA9S"),r=a.n(s),i=a("HzJ8"),n=a.n(i),l=a("lC5x"),o=a.n(l),c=a("J0Oq"),h=a.n(c),p=a("Yr0d"),d=a("VAi0"),u=a("NmBu"),v={components:{loadinganite:p.a,replyList:d.a,replyEditBox:u.a},created:function(){this.shareId=this.$route.query.id,this.$utils.cache.shardDetailVue=this,this.getDetil()},data:function(){return{loading:!0,isReplayChild:!1,shardData:void 0,shareId:"",replyCont:"",showReplyBox:!1,tearPlaTxt:"发表评论",cacheObj:null,replyList:[],cIndex:-1,pIndex:-1}},methods:{onClickLeft:function(){this.$router.go(-1)},likeClick:function(e){var t=this;return h()(o.a.mark(function a(){var s,r;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!t.replyList[e].parse){a.next=2;break}return a.abrupt("return");case 2:return t.replyList[e].parse=!0,t.replyList[e].praseCount+=1,s=t.replyList[e].id,r=t.replyList[e].userId,a.next=7,t.$apihelper.parseLikeReplay({shareId:t.shareId,praseUserId:r,commentId:s,type:"A"});case 7:a.sent;case 8:case"end":return a.stop()}},a,t)}))()},showMoreReplay:function(){this.$router.push({name:"moreReplay",query:{shareId:this.shareId}})},getDetil:function(){var e=this;return h()(o.a.mark(function t(){var a,s,r,i,l,c,h;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$apihelper.getShardDetail(e.shareId);case 2:if(a=t.sent){t.next=5;break}return t.abrupt("return");case 5:for(e.loading=!1,a.d.share.createTime=e.$utils.dateFromat(a.d.share.createTime),a.d.share.shareImg=a.d.share.shareImg.split(","),s=!0,r=!1,i=void 0,t.prev=11,l=n()(a.d.replies);!(s=(c=l.next()).done);s=!0)(h=c.value).replyTime=e.$utils.dateFromat(h.replyTime);t.next=19;break;case 15:t.prev=15,t.t0=t.catch(11),r=!0,i=t.t0;case 19:t.prev=19,t.prev=20,!s&&l.return&&l.return();case 22:if(t.prev=22,!r){t.next=25;break}throw i;case 25:return t.finish(22);case 26:return t.finish(19);case 27:e.shardData=a.d.share,e.replyList=a.d.replies||[];case 29:case"end":return t.stop()}},t,e,[[11,15,19,27],[20,,22,26]])}))()},previewImage:function(e,t){this.$utils.imagePreview(e,t)},textareaBlur:function(){this.isReplayChild=!1,this.tearPlaTxt="发表评论"},hidereplyBox:function(){this.showReplyBox=!1,this.textareaBlur()},replyChildBtn:function(e){var t=e.item,a=e.pIndex,s=e.cIndex;this.cIndex=s,this.pIndex=a,this.isReplayChild=!0,this.tearPlaTxt="回复"+t.userName,this.showReplyBox=!0,this.cacheObj={commentId:this.replyList[a].id,shareId:this.shareId,replyUserId:t.userId,replyId:t.id}},removeReply:function(e){var t=e.cIndex,a=e.pIndex;~t?this.replyList[a].replies.splice(t,1):this.replyList.splice(a,1)},sumbitReplay:function(e){var t=this;return h()(o.a.mark(function a(){var s,r,i,n;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t.cacheObj.content=e,!t.isReplayChild){a.next=13;break}return a.next=4,t.$apihelper.shareReplyArticleChild(t.cacheObj);case 4:s=a.sent,console.log("回复二级评论",s),r=t.replyList[t.pIndex],i=t.replyList[t.pIndex].replies,r.replyCount+=1,i&&i.length<2&&(s.d.repltUserName=t.replyList[t.pIndex].userName,s.d.replyTime=t.$utils.dateFromat(s.d.replyTime),s.d.userName=t.$store.state.user.userInfo.userName,i.push(s.d)),t.hidereplyBox(),a.next=24;break;case 13:return a.next=15,t.$apihelper.shareReplyArticle(t.cacheObj);case 15:n=a.sent,console.log("回复楼主",n),n.d.replyTime=t.$utils.dateFromat(n.d.replyTime),n.d.userAvatar=t.$store.state.user.userInfo.userAvatar,n.d.userName=t.$store.state.user.userInfo.userName,n.d.replyCount=0,n.d.replies=[],t.replyList.push(n.d),t.hidereplyBox();case 24:case"end":return a.stop()}},a,t)}))()},goUserinfo:function(){if(this.shardData){var e=this.shardData,t=e.shareUserName,a=e.shareUserAvatar,s=e.shareUserId;this.$myplug.info.show({username:t,userava:a,userid:s})}},deleteMyShrea:function(){var e,t=this;this.$dialog.alert({message:"确定删除吗",showCancelButton:!0,callback:(e=h()(o.a.mark(function e(a){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("confirm"!==a){e.next=7;break}return e.next=3,t.$apihelper.delectShare(t.shardData.id);case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:t.$router.replace({name:"home",params:{reload:!0}});case 7:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)})})},handlerClick:function(e){var t=this;return{replyBtn:function(){t.showReplyBox=!0,t.cacheObj={shareId:t.shareId}}}[e]()}},computed:{isMe:function(){return this.shardData&&this.shardData.shareUserId===this.$store.state.user.userId}},onUnload:function(){r()(this.$data,this.$options.data())}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"shard-detail"}},[a("van-nav-bar",{staticClass:"topNavBar",attrs:{title:"详情页","left-text":"返回","left-arrow":""},on:{"click-left":e.onClickLeft}},[a("span",{directives:[{name:"show",rawName:"v-show",value:e.isMe,expression:"isMe"}],staticClass:"iconfont icon-shanchu",attrs:{slot:"right"},on:{click:e.deleteMyShrea},slot:"right"})]),e._v(" "),e.shardData?a("div",{staticClass:"wrap"},[a("div",{staticClass:"header"},[a("div",{staticClass:"info"},[a("img",{staticClass:"userava",attrs:{src:e.shardData.shareUserAvatar},on:{click:e.goUserinfo}}),e._v(" "),a("div",{staticClass:"titles"},[a("p",{staticClass:"username"},[e._v(e._s(e.shardData.shareUserName))]),e._v(" "),a("p",{staticClass:"time"},[e._v(e._s(e.shardData.createTime))])])])]),e._v(" "),a("div",{staticClass:"conent"},[a("p",{staticClass:"share-content"},[e._v(e._s(e.shardData.shareContent))]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.shardData.shareImg[0],expression:"shardData.shareImg[0]"}],staticClass:"imgs"},e._l(e.shardData.shareImg,function(t,s){return a("img",{key:s,staticClass:"img",attrs:{src:t},on:{click:function(t){return t.stopPropagation(),e.previewImage(e.shardData.shareImg,s)}}})}),0)]),e._v(" "),a("div",{staticClass:"action-list"},[a("div",{staticClass:"edit",on:{click:function(t){return e.handlerClick("replyBtn")}}},[a("span",{staticClass:"iconfont icon-bianji",staticStyle:{"font-size":"20px"}}),e._v(" "),a("span",[e._v("写评论")])]),e._v(" "),e._m(0),e._v(" "),a("div",{staticClass:"action-item"},[a("p",{staticClass:"iconfont icon-pinglun"}),e._v(" "),a("p",{staticClass:"txt"},[e._v(e._s(e.shardData.shareReplyCount))])]),e._v(" "),a("div",{staticClass:"action-item"},[a("p",{staticClass:"iconfont icon-zhuanfa"}),e._v(" "),a("p",{staticClass:"txt"},[e._v(e._s(e.shardData.shareTransmitCount))])])]),e._v(" "),a("div",{staticClass:"replay-list"},[a("h3",{staticClass:"rep-w-h"},[e._v("评论")]),e._v(" "),e._l(e.replyList,function(t,s){return a("replyList",{key:s,attrs:{reItem:t,index:s},on:{btnClick:e.replyChildBtn,likeClick:e.likeClick,removeReply:e.removeReply}})}),e._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:e.replyList.length&&e.replyList.length>=5,expression:"replyList.length && replyList.length >= 5"}],staticClass:"more-replay",on:{click:function(t){return t.stopPropagation(),e.showMoreReplay(t)}}},[e._v("查看更多评论")]),e._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:e.replyList.length&&e.replyList.length<5,expression:"replyList.length && replyList.length < 5"}],staticClass:"no-more"},[e._v("暂无更多评论")]),e._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:!e.replyList.length,expression:"!replyList.length"}],staticClass:"no-more"},[e._v("来做第一个沙发吧")])],2)]):e._e(),e._v(" "),e.loading?a("loadinganite"):e._e(),e._v(" "),a("replyEditBox",{attrs:{tearPlaTxt:e.tearPlaTxt},on:{"on-submit":e.sumbitReplay},model:{value:e.showReplyBox,callback:function(t){e.showReplyBox=t},expression:"showReplyBox"}}),e._v(" "),a("transition",{attrs:{"enter-active-class":"animated fadeRight","leave-active-class":"animated fadeOutLeft"}},[a("router-view",{staticClass:"app-content",staticStyle:{"z-index":"99"}})],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"action-item"},[t("p",{staticClass:"iconfont icon-xihuancon"}),this._v(" "),t("p",{staticClass:"txt"},[this._v("1")])])}]};var y=a("C7Lr")(v,m,!1,function(e){a("Byys")},"data-v-6e8d249a",null);t.default=y.exports},Byys:function(e,t){}});
//# sourceMappingURL=14.0a1ea52e785032d64086.js.map